# SportsMate: 프로젝트 기술 개요 및 기능 명세서

> **주제**: SportsMate (스포츠 직관 메이트 매칭 플랫폼)
> **작성일**: 2025-12-19

---

## 1. 프로젝트 개요 (Identity)

**SportsMate**는 **V-League(배구)**와 **KBL/WKBL(농구)** 팬들을 위한 **올인원 직관 동행 플랫폼**입니다. 혼자 경기장에 가기(혼직) 망설여지는 팬들이 함께 응원할 메이트를 안전하고 쉽게 구할 수 있도록 돕습니다.

- **해결하려는 문제 (Core Problem)**:
  - 현장감 있는 직관을 원하지만, 혼자라서 망설이는 '혼직' 팬들의 고충 해결.
  - 기존 팬 커뮤니티(카페, 갤러리)의 비효율적인 동행 구인 방식 개선 (일정 확인 → 글 작성 → 연락의 번거로움).
- **차별화 포인트 (UVP)**:
  - **일정 기반 매칭**: 막연한 게시판 글쓰기가 아닌, **"경기 일정"**을 선택하여 방을 만드는 구조.
  - **안전성 (Safety)**: 방장의 **"동행 승인제"** 및 엄격한 멤버 관리(강퇴/차단) 시스템 도입.
  - **게이미피케이션 (Gamification)**: 직관 승률(Win Rate) 분석 및 '승리요정' 칭호 부여로 지속적인 사용 유도.

---

## 2. 핵심 기능 및 비즈니스 로직

### A. 📅 경기 일정 자동화 (The Foundation)

- **기능**: 배구/농구 리그의 실시간 경기 정보(일시, 팀, 장소, 점수) 제공.
- **기술적 구현**:
  - **Web Scraper (`scraper.service.ts`)**: **Puppeteer**를 사용하여 네이버 스포츠 등의 경기 데이터를 주기적으로 크롤링.
  - **로직**: 동적 DOM 요소를 파싱하여 경기 시간, 팀명, 스코어, 경기장 정보를 추출 및 DB 적재.
  - **역할**: `matches` 테이블에 저장되어 모든 "동행 방(Room)" 생성의 기준 데이터(Parent Entity)가 됨.

### B. 🤝 메이트 매칭 시스템 (State Machine)

- **기능**: 사용자가 특정 경기에 대해 '방(Room)'을 개설하고, 참여자를 모집하는 핵심 기능.
- **사용자 플로우**:
  1.  **생성**: 방장이 응원 팀, 인원(Max Count), 지역을 설정해 방 개설.
  2.  **신청**: 참여자가 신청 (`PENDING`).
  3.  **검토**: 방장이 신청자의 프로필(승률, 매너 등)을 확인.
  4.  **결정**: 방장이 승인(`JOINED`) 또는 거절(`REJECTED`) 처리.
  5.  **소통**: 승인된 멤버만 비공개 채팅방 입장 가능.
- **데이터베이스 설계 (`user_rooms` table)**:
  - 엄격한 상태머신(`ENUM`) 적용: `'PENDING', 'CANCELLED', 'REJECTED', 'JOINED', 'LEFT', 'KICKED'`.
  - **Unique Constraint**: `(user_id, room_id)` 복합 유니크 키를 통해 한 방에 중복 신청 방지 및 단일 상태 보장.

### C. 💬 실시간 응원톡 & 프라이빗 채팅

- **기능 1: 공식 응원톡**: 매 경기마다 자동으로 생성되는 오픈 채팅방 (누구나 참여).
- **기능 2: 프라이빗 채팅**: 매칭이 성사된 멤버들끼리 세부 약속을 잡는 폐쇄형 채팅.
- **기술 스택**: **Socket.IO** (Next.js와 별도로 분리된 서버 운영으로 연결 안정성 확보).
- **로직**:
  - `room_id` (DB PK)와 `match_id`를 Room ID로 사용하여 소켓 룸 분기.
  - 시스템 메시지 지원 (예: "OO님이 입장하셨습니다", "OO님이 강퇴되었습니다").

### D. 🏅 직관 인증 & 게이미피케이션

- **기능**: 사용자가 **"티켓 사진"**을 올려 직관을 인증하면 승률을 계산해주는 시스템.
- **로직 (Win Rate Calculation)**:
  - 사용자가 응원하는 팀의 경기 결과(승/패)와 직관 DB를 대조.
  - 자동으로 사용자의 **직관 승률(Win Rate)**과 **총 직관 횟수(Total Visits)** 업데이트.
- **보상**: 승률에 따라 '승리요정', '직관러' 등의 칭호(Title) 부여 → 프로필에 노출.

---

## 3. 데이터베이스 스키마 및 모델링

**MySQL (InnoDB)**를 사용하여 관계형 데이터의 무결성을 보장합니다.

- **`users`**: 사용자 정보, OAuth(카카오), 게이미피케이션 스탯(`win_rate`, `title`).
  - _JSON Type_: `cheering_styles` 컬럼에 태그 목록 저장 (유연성 확보).
- **`matches`**: 종목, 팀, 시간 정보를 담은 마스터 데이터.
- **`rooms`**: `matches`에 종속된 일회성 모임 데이터.
- **`user_rooms`**: **[핵심]** User와 Room의 N:M 관계를 해소하며, 신청 상태(Status)를 관리하는 교차 테이블.
- **`room_messages`**: 채팅 내역 저장 (나중에 들어온 사람도 이전 대화 확인 가능).
- **`ticket_auths`**: 인증 요청 대기열 및 승인 상태 관리.

---

## 4. 기술 스택 (Tech Stack)

| 구분          | 기술 (Technology)           | 선정 이유                                                 |
| :------------ | :-------------------------- | :-------------------------------------------------------- |
| **Frontend**  | **Next.js 15 (App Router)** | 최신 React 기능을 활용하고, 검색 엔진 노출(SEO)에 유리함. |
| **Language**  | **TypeScript**              | 복잡한 매칭 상태(Status) 관리 시 타입 안정성 보장.        |
| **Styling**   | **Tailwind CSS**            | 빠르고 직관적인 UI 개발 및 모바일 반응형 최적화.          |
| **State**     | **Zustand**                 | Redux보다 가볍고 Boilerplate가 적은 전역 상태 관리.       |
| **Backend**   | **Next.js API Routes**      | 프론트엔드와 통합된 서버리스 환경 구축 용이.              |
| **Real-time** | **Socket.IO**               | 채팅 기능을 위한 저지연 양방향 통신 구현.                 |
| **Database**  | **MySQL (via mysql2)**      | 매칭/예약 시스템에 필수적인 ACID 트랜잭션 지원.           |
| **Crawling**  | **Puppeteer**               | 동적 렌더링되는 스포츠 사이트의 데이터 크롤링.            |

---

## 5. 프로젝트 구조 (Directory Structure)

- `src/services/`: 비즈니스 로직을 API 라우트와 분리하여 **Service Layer** 패턴 적용 (유지보수성 향상).
  - `match.service.ts`: 일정 조회 및 필터링.
  - `room.service.ts`: 방 생성, 참여, 상태 변경 등 핵심 로직.
  - `scraper.service.ts`: 외부 데이터 수집 로직 격리.
- `socket-server/`: 안정적인 소켓 연결 유지를 위해 Next.js와 독립된 Node.js 프로세스로 분리.
